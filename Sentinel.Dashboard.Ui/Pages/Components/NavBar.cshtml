<template id="nav-bar">
    <header>
      <div class="w-full bg-glass sticky-top fixed z-50" :class="[$route.query?.kiosk ? 'hidden group-hover:block' : '']">
        <nav class="mx-auto max-w-screen-xl justify-between flex" aria-label="Main navigation">
          <div class="flex grow p-0 me-5">
            <router-link :to="{name: 'environments', query: $route.query }" href="/" aria-label="Sentinel"
                         class="text-slate-600 hover:text-brand flex items-center">
              
              <svg xmlns="http://www.w3.org/2000/svg" class="mr-2 my-1 h-9 fill-brand " xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 372.7 214.5">
                <g id="icon">
                  <path d="M261.6,189.7c-20.7,9.2-41.2,14.9-62.8,16.5c-43.5,3.2-82.2-10.6-118.7-32.6
                            		c-26.2-15.8-49.6-35.1-70.5-57.4c-8.6-9.2-8.8-14.2-0.2-23.3C45.1,55.3,85.9,25.4,135.9,9.8C179.9-4,222.7,1.1,264.3,20.2
                            		c38.8,17.8,71.9,43.4,100.8,74.6c5.5,6,6.1,12.1,1.4,17.6c-17,19.3-36.4,35.8-57.6,50.8c-6.5-4.7-12.9-9.4-18.6-13.6
                            		c17.8-14.6,35.5-29.2,52.9-43.6c-0.7-1.7-0.8-2.3-1.1-2.6c-33.9-34.5-73.2-59.9-120.1-73c-29.7-8.3-58.7-5.4-87.5,5
                            		C94.2,50,59.8,73.5,29.3,104.7c8.5,7.7,16.7,15.4,25.3,22.7c31.3,26.3,66.6,44.7,106.7,53.5c24.7,5.4,48.9,2.3,72.5-6.1
                            		c3.6-1.3,6.2-1.1,9.3,1.4C248.8,180.7,254.9,184.8,261.6,189.7z"/>
                  <path d="M235.9,151.1c-30.3,29.5-71.9,25.8-96.5,2.1c-24.7-23.8-27.8-62.5-7.1-89.7
                            		c21.1-27.7,58.8-35.1,88.6-17.4c28,16.5,43.6,54,24.9,91.1c3.9,2.8,7.9,5.7,11.9,8.5c0.5,0.3,1.4,0.5,1.8,0.2
                            		c4.6-2.8,7.7,0.1,11.1,2.5c18.3,13,36.7,26,55.1,39c5,3.5,5.7,6.2,2.9,11.8c-0.8,1.5-1.8,3-2.8,4.3c-8.4,10.8-10.5,11-21.6,3.2
                            		c-17.2-12.2-34.5-24.4-51.7-36.6c-3.1-2.2-5.9-4.1-4.8-8.7c0.2-0.9-1-2.4-1.9-3.1C242.6,155.8,239.3,153.6,235.9,151.1z
                            		 M186.6,55.4c-27.2-0.1-49.4,21.9-49.4,48.9c-0.1,27,22,49.2,49.1,49.3c26.9,0.1,49.3-22.3,49.2-49.2
                            		C235.4,77.4,213.5,55.5,186.6,55.4z"/>
                  <path d="M162.5,104.4c-0.1-13.3,10.5-23.9,23.8-24c13.3,0,23.9,10.6,23.9,23.8
                            		c0,13.4-10.4,23.8-23.8,23.9C173,128.3,162.5,117.8,162.5,104.4z"/>
                </g>
              </svg>

              <span class="py-2 text-xl leading-8 font-semibold align-middle">@ViewData["Title"]</span>
            </router-link>
            
            <template v-if="$route.path != '/'">
              <span class="px-3 text-xl font-semibold align-middle">-</span>
              <router-link :to="{ name: 'overview', params: { env: $route.params.env }}" class="text-slate-600 hover:text-[#b42830] text-xl font-semibold align-middle">
                Environment: {{ $route.params.env }}
              </router-link>
            </template>
          </div>
    
          <div id="envNav" class="flex justify-center">
            <template v-if="$route.path != '/'">
              <div>
                <div class=" relative" aria-label="Select Environment">
                  <button @@click="envVisible = !envVisible" type="button"
                          class="px-6 py-2.5 bg-gray-200 text-gray-700 font-medium text-xs leading-tight uppercase rounded shadow-md transition duration-150 ease-in-out flex items-center whitespace-nowrap 
                          hover:bg-gray-100 hover:shadow-lg 
                          focus:bg-gray-100 focus:shadow-lg focus:outline-none focus:ring-0">
                    Environments
                    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-down" class="w-2 ml-2"
                         role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
                      <path fill="currentColor" d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"></path>
                    </svg>
                  </button>
                  <template v-if="envVisible && environments.length > 0">
                    <div class="w-40 min-w-max absolute bg-gray-100 text-base float-left py-2 list-none text-left 
                              rounded-lg shadow-lg mt-1 m-0 bg-clip-padding border-none" ref="envDropdown">
                      <div v-for="e in environments" class="hover:bg-white">
                        <router-link class="text-sm py-2 px-4 font-normal block w-full whitespace-nowrap bg-transparent text-gray-700 hover:text-[#b42830]"
                                     :to="{ name: 'overview', params: { env: e }}" @@click="envVisible = false">
                          {{ e }}
                        </router-link>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
              </template>
          </div>
        </nav>
      </div>
      <div class="h-14"></div>
    </header>
</template>

<script>
    components["nav-bar"] = {
      template: "#nav-bar",
      data() {
        return {
          envVisible: false,
        }
      },
      emits: ['no-environments'],
      props: ['environments'],
      methods: {
       clickHandler(event) {
         const { target } = event;
         const { $el } = this;
  
         if (!$el.contains(target)) {
           this.$data.envVisible = false;
         }
       }        
      },
      async mounted() {
        document.addEventListener('click', this.clickHandler);

        if (this.$props.environments.length === 0){
          this.$emit('no-environments')
        }
      },
    };
</script>
